<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš™ï¸ ç³»ç»Ÿè®¾ç½® - æ—¥è¯­å­¦ä¹ ç³»ç»Ÿ</title>

    <!-- å¼•å…¥CSSæ–‡ä»¶ -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/settings.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <header class="page-header">
            <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
            <p>ä¸ªæ€§åŒ–ä½ çš„å­¦ä¹ ä½“éªŒ</p>
        </header>

        <!-- è®¾ç½®å¯¼èˆª -->
        <div class="settings-nav">
            <button class="nav-btn active" data-section="general">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">é€šç”¨è®¾ç½®</span>
            </button>
            <button class="nav-btn" data-section="learning">
                <span class="nav-icon">ğŸ“š</span>
                <span class="nav-text">å­¦ä¹ è®¾ç½®</span>
            </button>
            <button class="nav-btn" data-section="agents">
                <span class="nav-icon">ğŸ¤–</span>
                <span class="nav-text">æ™ºèƒ½ä½“è®¾ç½®</span>
            </button>
            <button class="nav-btn" data-section="notifications">
                <span class="nav-icon">ğŸ””</span>
                <span class="nav-text">é€šçŸ¥è®¾ç½®</span>
            </button>
            <button class="nav-btn" data-section="privacy">
                <span class="nav-icon">ğŸ”’</span>
                <span class="nav-text">éšç§å®‰å…¨</span>
            </button>
        </div>

        <!-- è®¾ç½®å†…å®¹åŒºåŸŸ -->
        <div class="settings-content">
            <!-- é€šç”¨è®¾ç½® -->
            <div class="settings-section active" id="general">
                <h2>ğŸ  é€šç”¨è®¾ç½®</h2>

                <div class="setting-group">
                    <h3>ğŸŒ è¯­è¨€ä¸åœ°åŒº</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>ç•Œé¢è¯­è¨€</strong>
                            <span class="setting-desc">é€‰æ‹©ç³»ç»Ÿç•Œé¢æ˜¾ç¤ºè¯­è¨€</span>
                        </div>
                        <div class="setting-control">
                            <select class="setting-select" id="interface-language">
                                <option value="zh-CN" selected>ç®€ä½“ä¸­æ–‡</option>
                                <option value="zh-TW">ç¹ä½“ä¸­æ–‡</option>
                                <option value="ja-JP">æ—¥æœ¬èª</option>
                                <option value="en-US">English</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>æ—¶åŒºè®¾ç½®</strong>
                            <span class="setting-desc">ç”¨äºå­¦ä¹ æé†’å’Œç»Ÿè®¡</span>
                        </div>
                        <div class="setting-control">
                            <select class="setting-select" id="timezone">
                                <option value="Asia/Shanghai" selected>åŒ—äº¬æ—¶é—´ (GMT+8)</option>
                                <option value="Asia/Tokyo">ä¸œäº¬æ—¶é—´ (GMT+9)</option>
                                <option value="America/New_York">çº½çº¦æ—¶é—´ (GMT-5)</option>
                                <option value="Europe/London">ä¼¦æ•¦æ—¶é—´ (GMT+0)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸ¨ å¤–è§‚ä¸»é¢˜</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>ä¸»é¢˜æ¨¡å¼</strong>
                            <span class="setting-desc">é€‰æ‹©ä½ å–œæ¬¢çš„ç•Œé¢ä¸»é¢˜</span>
                        </div>
                        <div class="setting-control">
                            <div class="theme-selector">
                                <div class="theme-option light active" data-theme="light">
                                    <div class="theme-preview"></div>
                                    <span class="theme-name">æ˜äº®</span>
                                </div>
                                <div class="theme-option dark" data-theme="dark">
                                    <div class="theme-preview"></div>
                                    <span class="theme-name">æš—é»‘</span>
                                </div>
                                <div class="theme-option sakura" data-theme="sakura">
                                    <div class="theme-preview"></div>
                                    <span class="theme-name">æ¨±èŠ±</span>
                                </div>
                                <div class="theme-option matcha" data-theme="matcha">
                                    <div class="theme-preview"></div>
                                    <span class="theme-name">æŠ¹èŒ¶</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>è‡ªåŠ¨åˆ‡æ¢ä¸»é¢˜</strong>
                            <span class="setting-desc">æ ¹æ®æ—¶é—´è‡ªåŠ¨åˆ‡æ¢æ˜æš—ä¸»é¢˜</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-theme">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸ”Š éŸ³é¢‘è®¾ç½®</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>ç³»ç»ŸéŸ³æ•ˆ</strong>
                            <span class="setting-desc">å¯ç”¨æŒ‰é’®ç‚¹å‡»å’Œé€šçŸ¥éŸ³æ•ˆ</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="system-sounds" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>è¯­éŸ³æ’­æ”¾</strong>
                            <span class="setting-desc">æ—¥è¯­å‘éŸ³æ’­æ”¾åŠŸèƒ½</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="voice-playback" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å­¦ä¹ è®¾ç½® -->
            <div class="settings-section" id="learning">
                <h2>ğŸ“š å­¦ä¹ è®¾ç½®</h2>

                <div class="setting-group">
                    <h3>ğŸ¯ å­¦ä¹ ç›®æ ‡</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>ç›®æ ‡JLPTç­‰çº§</strong>
                            <span class="setting-desc">è®¾ç½®ä½ çš„å­¦ä¹ ç›®æ ‡ç­‰çº§</span>
                        </div>
                        <div class="setting-control">
                            <select class="setting-select" id="target-jlpt">
                                <option value="N5">N5 - å…¥é—¨</option>
                                <option value="N4">N4 - åˆçº§</option>
                                <option value="N3" selected>N3 - ä¸­çº§</option>
                                <option value="N2">N2 - ä¸­é«˜çº§</option>
                                <option value="N1">N1 - é«˜çº§</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>æ¯æ—¥å­¦ä¹ æ—¶é—´</strong>
                            <span class="setting-desc">è®¾ç½®æ¯å¤©çš„å­¦ä¹ ç›®æ ‡æ—¶é—´</span>
                        </div>
                        <div class="setting-control">
                            <div class="time-selector">
                                <button class="time-btn" data-time="15">15åˆ†é’Ÿ</button>
                                <button class="time-btn" data-time="30">30åˆ†é’Ÿ</button>
                                <button class="time-btn active" data-time="60">1å°æ—¶</button>
                                <button class="time-btn" data-time="90">1.5å°æ—¶</button>
                                <button class="time-btn" data-time="120">2å°æ—¶</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸ“ å­¦ä¹ åå¥½</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>éš¾åº¦è‡ªåŠ¨è°ƒèŠ‚</strong>
                            <span class="setting-desc">ç³»ç»Ÿæ ¹æ®å­¦ä¹ è¡¨ç°è‡ªåŠ¨è°ƒèŠ‚å†…å®¹éš¾åº¦</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-difficulty" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>æ˜¾ç¤ºç½—é©¬éŸ³</strong>
                            <span class="setting-desc">åœ¨å‡åä¸‹æ–¹æ˜¾ç¤ºç½—é©¬éŸ³æ ‡æ³¨</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-romaji">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>è‡ªåŠ¨ç¿»è¯‘</strong>
                            <span class="setting-desc">è‡ªåŠ¨æ˜¾ç¤ºæ—¥è¯­å†…å®¹çš„ä¸­æ–‡ç¿»è¯‘</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-translate" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ™ºèƒ½ä½“è®¾ç½® -->
            <div class="settings-section" id="agents">
                <h2>ğŸ¤– æ™ºèƒ½ä½“è®¾ç½®</h2>

                <div class="setting-group">
                    <h3>ğŸ­ æ™ºèƒ½ä½“ä¸ªæ€§</h3>
                    <div class="agent-personality-list">
                        <div class="agent-personality-item">
                            <div class="agent-info">
                                <div class="agent-avatar tanaka">ç”°</div>
                                <div class="agent-details">
                                    <div class="agent-name">ç”°ä¸­å…ˆç”Ÿ</div>
                                    <div class="agent-role">è¯­æ³•ä¸“å®¶</div>
                                </div>
                            </div>
                            <div class="personality-controls">
                                <div class="control-item">
                                    <label>ä¸¥æ ¼ç¨‹åº¦</label>
                                    <input type="range" min="1" max="10" value="8" class="personality-slider">
                                </div>
                                <div class="control-item">
                                    <label>å‹å¥½åº¦</label>
                                    <input type="range" min="1" max="10" value="6" class="personality-slider">
                                </div>
                            </div>
                        </div>

                        <div class="agent-personality-item">
                            <div class="agent-info">
                                <div class="agent-avatar koumi">ç¾</div>
                                <div class="agent-details">
                                    <div class="agent-name">å°ç¾</div>
                                    <div class="agent-role">å¯¹è¯ä¼™ä¼´</div>
                                </div>
                            </div>
                            <div class="personality-controls">
                                <div class="control-item">
                                    <label>æ´»æ³¼ç¨‹åº¦</label>
                                    <input type="range" min="1" max="10" value="9" class="personality-slider">
                                </div>
                                <div class="control-item">
                                    <label>è€å¿ƒåº¦</label>
                                    <input type="range" min="1" max="10" value="8" class="personality-slider">
                                </div>
                            </div>
                        </div>

                        <div class="agent-personality-item">
                            <div class="agent-info">
                                <div class="agent-avatar yamada">å±±</div>
                                <div class="agent-details">
                                    <div class="agent-name">å±±ç”°</div>
                                    <div class="agent-role">æ–‡åŒ–ä¸“å®¶</div>
                                </div>
                            </div>
                            <div class="personality-controls">
                                <div class="control-item">
                                    <label>è¯¦ç»†ç¨‹åº¦</label>
                                    <input type="range" min="1" max="10" value="7" class="personality-slider">
                                </div>
                                <div class="control-item">
                                    <label>å¹½é»˜æ„Ÿ</label>
                                    <input type="range" min="1" max="10" value="6" class="personality-slider">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é€šçŸ¥è®¾ç½® -->
            <div class="settings-section" id="notifications">
                <h2>ğŸ”” é€šçŸ¥è®¾ç½®</h2>

                <div class="setting-group">
                    <h3>ğŸ“± æ¨é€é€šçŸ¥</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>å­¦ä¹ æé†’</strong>
                            <span class="setting-desc">æ¯æ—¥å­¦ä¹ æ—¶é—´æé†’</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="study-reminder" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>å¤ä¹ æé†’</strong>
                            <span class="setting-desc">è¯æ±‡å’Œè¯­æ³•å¤ä¹ æé†’</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="review-reminder" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>æˆå°±é€šçŸ¥</strong>
                            <span class="setting-desc">è·å¾—æ–°æˆå°±æ—¶çš„é€šçŸ¥</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="achievement-notification" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>â° æé†’æ—¶é—´</h3>
                    <div class="time-settings">
                        <div class="time-setting-item">
                            <label>å­¦ä¹ æé†’æ—¶é—´</label>
                            <input type="time" value="09:00" class="time-input">
                        </div>
                        <div class="time-setting-item">
                            <label>å¤ä¹ æé†’æ—¶é—´</label>
                            <input type="time" value="19:00" class="time-input">
                        </div>
                    </div>
                </div>
            </div>

            <!-- éšç§å®‰å…¨ -->
            <div class="settings-section" id="privacy">
                <h2>ğŸ”’ éšç§å®‰å…¨</h2>

                <div class="setting-group">
                    <h3>ğŸ“Š æ•°æ®æ”¶é›†</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>å­¦ä¹ æ•°æ®åˆ†æ</strong>
                            <span class="setting-desc">å…è®¸ç³»ç»Ÿåˆ†æå­¦ä¹ æ•°æ®ä»¥æ”¹è¿›ä½“éªŒ</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="data-analysis" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <strong>åŒ¿åç»Ÿè®¡</strong>
                            <span class="setting-desc">å‚ä¸åŒ¿åä½¿ç”¨ç»Ÿè®¡ä»¥å¸®åŠ©æ”¹è¿›äº§å“</span>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="anonymous-stats" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ğŸ” è´¦æˆ·å®‰å…¨</h3>
                    <div class="security-actions">
                        <button class="security-btn" onclick="changePassword()">
                            <span class="btn-icon">ğŸ”‘</span>
                            <span class="btn-text">ä¿®æ”¹å¯†ç </span>
                        </button>
                        <button class="security-btn" onclick="exportData()">
                            <span class="btn-icon">ğŸ“¥</span>
                            <span class="btn-text">å¯¼å‡ºæ•°æ®</span>
                        </button>
                        <button class="security-btn danger" onclick="deleteAccount()">
                            <span class="btn-icon">ğŸ—‘ï¸</span>
                            <span class="btn-text">åˆ é™¤è´¦æˆ·</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¿å­˜æŒ‰é’® -->
        <div class="settings-footer">
            <button class="save-btn" onclick="saveSettings()">
                <span class="btn-icon">ğŸ’¾</span>
                <span class="btn-text">ä¿å­˜è®¾ç½®</span>
            </button>
            <button class="reset-btn" onclick="resetSettings()">
                <span class="btn-icon">ğŸ”„</span>
                <span class="btn-text">é‡ç½®é»˜è®¤</span>
            </button>
        </div>
    </div>

    <!-- å¼•å…¥JavaScriptæ–‡ä»¶ -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/settings.js"></script>
    <script src="../assets/js/animations.js"></script>

    <script>
        // è®¾ç½®é¡µé¢çš„JavaScripté€»è¾‘
        document.addEventListener('DOMContentLoaded', function() {
            initializeSettingsPage();
            bindSettingsEvents();

            console.log('âš™ï¸ ç³»ç»Ÿè®¾ç½®é¡µé¢å·²åˆå§‹åŒ–');
        });

        function initializeSettingsPage() {
            // åŠ è½½ä¿å­˜çš„è®¾ç½®
            loadSettings();

            // åˆå§‹åŒ–å¯¼èˆª
            initializeNavigation();

            // åˆå§‹åŒ–ä¸»é¢˜é€‰æ‹©å™¨
            initializeThemeSelector();

            // åˆå§‹åŒ–æ—¶é—´é€‰æ‹©å™¨
            initializeTimeSelector();
        }

        function bindSettingsEvents() {
            // ç»‘å®šæ‰€æœ‰åˆ‡æ¢å¼€å…³
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.addEventListener('change', function() {
                    handleToggleChange(this);
                });
            });

            // ç»‘å®šä¸ªæ€§æ»‘å—
            document.querySelectorAll('.personality-slider').forEach(slider => {
                slider.addEventListener('input', function() {
                    handlePersonalityChange(this);
                });
            });

            // ç»‘å®šä¸‹æ‹‰æ¡†
            document.querySelectorAll('.setting-select').forEach(select => {
                select.addEventListener('change', function() {
                    handleSelectChange(this);
                });
            });
        }

        function initializeNavigation() {
            const navBtns = document.querySelectorAll('.nav-btn');
            const sections = document.querySelectorAll('.settings-section');

            navBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
                    navBtns.forEach(b => b.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active'));

                    // æ·»åŠ å½“å‰æ´»è·ƒçŠ¶æ€
                    this.classList.add('active');
                    const targetSection = document.getElementById(this.dataset.section);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }

                    // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    targetSection.style.animation = 'fadeInUp 0.3s ease';
                });
            });
        }

        function initializeThemeSelector() {
            const themeOptions = document.querySelectorAll('.theme-option');

            themeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    themeOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');

                    const theme = this.dataset.theme;
                    applyTheme(theme);
                    showNotification(`ğŸ¨ å·²åˆ‡æ¢åˆ°${this.querySelector('.theme-name').textContent}ä¸»é¢˜`, 'success');
                });
            });
        }

        function initializeTimeSelector() {
            const timeBtns = document.querySelectorAll('.time-btn');

            timeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    timeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const time = this.dataset.time;
                    updateDailyGoal(time);
                    showNotification(`â° æ¯æ—¥å­¦ä¹ æ—¶é—´å·²è®¾ç½®ä¸º${this.textContent}`, 'success');
                });
            });
        }

        function handleToggleChange(toggle) {
            const settingName = toggle.id;
            const isEnabled = toggle.checked;

            console.log(`è®¾ç½® ${settingName} å·²${isEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`);

            // ä¿å­˜è®¾ç½®
            saveSetting(settingName, isEnabled);

            // æ˜¾ç¤ºé€šçŸ¥
            const settingNames = {
                'auto-theme': 'è‡ªåŠ¨ä¸»é¢˜åˆ‡æ¢',
                'system-sounds': 'ç³»ç»ŸéŸ³æ•ˆ',
                'voice-playback': 'è¯­éŸ³æ’­æ”¾',
                'auto-difficulty': 'éš¾åº¦è‡ªåŠ¨è°ƒèŠ‚',
                'show-romaji': 'ç½—é©¬éŸ³æ˜¾ç¤º',
                'auto-translate': 'è‡ªåŠ¨ç¿»è¯‘',
                'study-reminder': 'å­¦ä¹ æé†’',
                'review-reminder': 'å¤ä¹ æé†’',
                'achievement-notification': 'æˆå°±é€šçŸ¥',
                'data-analysis': 'æ•°æ®åˆ†æ',
                'anonymous-stats': 'åŒ¿åç»Ÿè®¡'
            };

            const displayName = settingNames[settingName] || settingName;
            showNotification(`${displayName}å·²${isEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'info');
        }

        function handlePersonalityChange(slider) {
            const value = slider.value;
            const agentCard = slider.closest('.agent-personality-item');
            const agentName = agentCard.querySelector('.agent-name').textContent;
            const controlLabel = slider.closest('.control-item').querySelector('label').textContent;

            console.log(`${agentName}çš„${controlLabel}å·²è°ƒæ•´ä¸º${value}`);

            // ä¿å­˜ä¸ªæ€§è®¾ç½®
            savePersonalitySetting(agentName, controlLabel, value);
        }

        function handleSelectChange(select) {
            const settingName = select.id;
            const value = select.value;

            console.log(`è®¾ç½® ${settingName} å·²æ›´æ”¹ä¸º ${value}`);

            // ä¿å­˜è®¾ç½®
            saveSetting(settingName, value);

            // æ˜¾ç¤ºé€šçŸ¥
            const settingNames = {
                'interface-language': 'ç•Œé¢è¯­è¨€',
                'timezone': 'æ—¶åŒº',
                'target-jlpt': 'ç›®æ ‡JLPTç­‰çº§'
            };

            const displayName = settingNames[settingName] || settingName;
            showNotification(`${displayName}å·²æ›´æ–°`, 'success');
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            saveSetting('current-theme', theme);
        }

        function updateDailyGoal(minutes) {
            saveSetting('daily-goal', minutes);
        }

        function loadSettings() {
            // ä»localStorageåŠ è½½è®¾ç½®
            try {
                const settings = JSON.parse(localStorage.getItem('user-settings') || '{}');

                // åº”ç”¨ä¿å­˜çš„è®¾ç½®
                Object.entries(settings).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = value;
                        } else if (element.tagName === 'SELECT') {
                            element.value = value;
                        }
                    }
                });

                console.log('âœ“ ç”¨æˆ·è®¾ç½®å·²åŠ è½½');
            } catch (e) {
                console.warn('âš ï¸ æ— æ³•åŠ è½½ç”¨æˆ·è®¾ç½®');
            }
        }

        function saveSetting(key, value) {
            try {
                const settings = JSON.parse(localStorage.getItem('user-settings') || '{}');
                settings[key] = value;
                localStorage.setItem('user-settings', JSON.stringify(settings));
            } catch (e) {
                console.warn('âš ï¸ æ— æ³•ä¿å­˜è®¾ç½®');
            }
        }

        function savePersonalitySetting(agent, property, value) {
            try {
                const personalitySettings = JSON.parse(localStorage.getItem('personality-settings') || '{}');
                if (!personalitySettings[agent]) {
                    personalitySettings[agent] = {};
                }
                personalitySettings[agent][property] = value;
                localStorage.setItem('personality-settings', JSON.stringify(personalitySettings));
            } catch (e) {
                console.warn('âš ï¸ æ— æ³•ä¿å­˜ä¸ªæ€§è®¾ç½®');
            }
        }

        function saveSettings() {
            showNotification('ğŸ’¾ æ‰€æœ‰è®¾ç½®å·²ä¿å­˜', 'success');

            // å®é™…ä¿å­˜é€»è¾‘
            const allSettings = {};

            // æ”¶é›†æ‰€æœ‰è®¾ç½®
            document.querySelectorAll('.toggle-switch input, .setting-select, .time-input').forEach(element => {
                if (element.id) {
                    if (element.type === 'checkbox') {
                        allSettings[element.id] = element.checked;
                    } else {
                        allSettings[element.id] = element.value;
                    }
                }
            });

            try {
                localStorage.setItem('user-settings', JSON.stringify(allSettings));
                console.log('âœ“ æ‰€æœ‰è®¾ç½®å·²ä¿å­˜åˆ°localStorage');
            } catch (e) {
                console.error('âŒ è®¾ç½®ä¿å­˜å¤±è´¥:', e);
            }
        }

        function resetSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                // æ¸…é™¤ä¿å­˜çš„è®¾ç½®
                localStorage.removeItem('user-settings');
                localStorage.removeItem('personality-settings');

                // é‡æ–°åŠ è½½é¡µé¢
                location.reload();

                showNotification('ğŸ”„ è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'info');
            }
        }

        // å®‰å…¨åŠŸèƒ½
        function changePassword() {
            const newPassword = prompt('è¯·è¾“å…¥æ–°å¯†ç ï¼š');
            if (newPassword && newPassword.length >= 6) {
                showNotification('ğŸ”‘ å¯†ç ä¿®æ”¹æˆåŠŸ', 'success');
            } else if (newPassword) {
                showNotification('âŒ å¯†ç é•¿åº¦è‡³å°‘6ä½', 'error');
            }
        }

        function exportData() {
            const userData = {
                settings: JSON.parse(localStorage.getItem('user-settings') || '{}'),
                personality: JSON.parse(localStorage.getItem('personality-settings') || '{}'),
                progress: JSON.parse(localStorage.getItem('user-progress') || '{}'),
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(userData, null, 2)], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `japanese-learning-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('ğŸ“¥ æ•°æ®å¯¼å‡ºå®Œæˆ', 'success');
        }

        function deleteAccount() {
            const confirmation = prompt('è¯·è¾“å…¥"DELETE"ç¡®è®¤åˆ é™¤è´¦æˆ·ï¼ˆæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼‰ï¼š');
            if (confirmation === 'DELETE') {
                // æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®
                localStorage.clear();

                alert('è´¦æˆ·å·²åˆ é™¤ï¼Œå³å°†è¿”å›é¦–é¡µ');
                window.location.href = '../index.html';
            } else if (confirmation) {
                showNotification('âŒ ç¡®è®¤æ–‡æœ¬ä¸æ­£ç¡®', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#FF9800' : '#2196F3'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideInRight 0.3s ease;
                max-width: 300px;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- è®¾ç½®é¡µé¢æ ·å¼ -->
    <style>
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* è®¾ç½®å¯¼èˆª */
        .settings-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        /* è®¾ç½®å†…å®¹ */
        .settings-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-section h2 {
            margin-bottom: 30px;
            color: #333;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .setting-group {
            margin-bottom: 35px;
        }

        .setting-group h3 {
            margin-bottom: 20px;
            color: #555;
            font-size: 1.2rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            flex: 1;
        }

        .setting-label strong {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .setting-desc {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .setting-control {
            margin-left: 20px;
        }

        /* ä¸‹æ‹‰æ¡†æ ·å¼ */
        .setting-select {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            min-width: 160px;
        }

        .setting-select:focus {
            border-color: #667eea;
            outline: none;
        }

        /* åˆ‡æ¢å¼€å…³ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* ä¸»é¢˜é€‰æ‹©å™¨ */
        .theme-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .theme-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .theme-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .theme-option.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .theme-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #ddd;
        }

        .theme-option.light .theme-preview { background: linear-gradient(45deg, #4A90E2, #FFFFFF); }
        .theme-option.dark .theme-preview { background: linear-gradient(45deg, #1A1A1A, #42A5F5); }
        .theme-option.sakura .theme-preview { background: linear-gradient(45deg, #FFB3C1, #FFE1E6); }
        .theme-option.matcha .theme-preview { background: linear-gradient(45deg, #7CB342, #DCEDC8); }

        .theme-name {
            font-size: 0.85rem;
            color: #666;
        }

        /* æ—¶é—´é€‰æ‹©å™¨ */
        .time-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .time-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .time-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .time-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* æ™ºèƒ½ä½“ä¸ªæ€§è®¾ç½® */
        .agent-personality-list {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .agent-personality-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .agent-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .agent-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .agent-avatar.tanaka { background: linear-gradient(45deg, #2196F3, #1976D2); }
        .agent-avatar.koumi { background: linear-gradient(45deg, #E91E63, #C2185B); }
        .agent-avatar.yamada { background: linear-gradient(45deg, #FF9800, #F57C00); }

        .agent-name {
            font-weight: bold;
            color: #333;
        }

        .agent-role {
            color: #666;
            font-size: 0.9rem;
        }

        .personality-controls {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-left: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-item label {
            font-size: 0.9rem;
            color: #666;
        }

        .personality-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .personality-slider:hover {
            opacity: 1;
        }

        .personality-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        /* æ—¶é—´è®¾ç½® */
        .time-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .time-setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .time-setting-item label {
            font-size: 0.9rem;
            color: #666;
        }

        .time-input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .time-input:focus {
            border-color: #667eea;
            outline: none;
        }

        /* å®‰å…¨æŒ‰é’® */
        .security-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .security-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .security-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .security-btn.danger {
            border-color: #f44336;
            color: #f44336;
        }

        .security-btn.danger:hover {
            background: #fff5f5;
        }

        /* è®¾ç½®é¡µè„š */
        .settings-footer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .save-btn, .reset-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .reset-btn {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #e0e0e0;
        }

        .save-btn:hover, .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .settings-content {
                padding: 25px;
            }

            .settings-nav {
                flex-direction: column;
            }

            .nav-btn {
                justify-content: center;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .setting-control {
                margin-left: 0;
            }

            .agent-personality-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .personality-controls {
                margin-left: 0;
                grid-template-columns: 1fr;
            }

            .time-settings {
                grid-template-columns: 1fr;
            }

            .theme-selector {
                justify-content: center;
            }

            .time-selector {
                justify-content: center;
            }

            .settings-footer {
                flex-direction: column;
            }

            .save-btn, .reset-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</body>
</html>